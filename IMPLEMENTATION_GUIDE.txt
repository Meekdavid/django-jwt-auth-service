ğŸ”§ Django JWT Authentication Service - Implementation Guide
================================================================

ğŸ“‹ TABLE OF CONTENTS
====================
1. Rate Limiting Implementation
2. Redis-based Password Reset System
3. JWT Token Management
4. Custom Throttling Classes
5. Security Features Overview
6. Database Integration
7. API Documentation Setup

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ğŸš¦ RATE LIMITING IMPLEMENTATION
==================================

ğŸ“ Location: auth_service/utils/throttles.py

The project implements sophisticated rate limiting using django-ratelimit and custom throttling classes:

ğŸ”¹ Custom Throttle Classes:
   - EmailRateThrottle: Base class for email-based rate limiting
   - LoginRateThrottle: 5 attempts per minute per IP/email
   - PasswordResetRateThrottle: 3 attempts per minute per IP/email
   - RegistrationRateThrottle: 10 attempts per hour per IP
   - PasswordResetCompletionRateThrottle: 10 attempts per hour per IP

ğŸ”¹ Implementation Details:
   - Uses Redis for distributed rate limiting across multiple server instances
   - Combines IP address and email for more granular control
   - Custom cache key generation for flexible throttling strategies
   - Graceful handling of Redis connection failures

ğŸ”¹ Integration:
   - Applied via decorators in views.py: @ratelimit(key='ip', rate='5/m', method='POST')
   - DRF throttle classes applied in viewsets: throttle_classes = [LoginRateThrottle]
   - Rate limit headers included in API responses for client awareness

ğŸ”¹ Testing:
   - Comprehensive test script: auth_service/scripts/test_rate_limiting.py
   - Automated test runners for Windows (.bat) and Linux/Mac (.sh)
   - Integration tests verify rate limiting across different endpoints

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2. ğŸ” REDIS-BASED PASSWORD RESET SYSTEM
=======================================

ğŸ“ Location: auth_service/utils/password_reset_service.py

Advanced password reset system using Redis for secure token storage:

ğŸ”¹ Token Generation:
   - 32-byte URL-safe random tokens using secrets.token_urlsafe()
   - Cryptographically secure token generation
   - No predictable patterns or timing attacks

ğŸ”¹ Redis Storage Strategy:
   - Tokens stored with 10-minute expiration
   - Key format: "password_reset:{token}"
   - Value contains user email for verification
   - Automatic cleanup via Redis TTL

ğŸ”¹ Security Features:
   - Single-use tokens (consumed after verification)
   - Time-limited validity (10 minutes)
   - Email verification before token creation
   - Rate limiting on reset requests
   - Secure token transmission

ğŸ”¹ Implementation Flow:
   1. User requests password reset via email
   2. System validates email exists
   3. Generate secure token and store in Redis
   4. Send email with reset link (token included)
   5. User clicks link, token is verified and consumed
   6. New password is set, token is invalidated

ğŸ”¹ Redis Integration:
   - Uses django-redis for seamless Django integration
   - Connection pooling for performance
   - Fallback handling for Redis unavailability
   - Configuration via REDIS_URL environment variable

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3. ğŸ« JWT TOKEN MANAGEMENT
==========================

ğŸ“ Location: accounts/views.py, auth_service/settings/base.py

Comprehensive JWT implementation using djangorestframework-simplejwt:

ğŸ”¹ Token Configuration:
   - Access Token: 1-hour lifetime (configurable)
   - Refresh Token: 7-day lifetime (configurable)
   - Automatic token rotation on refresh
   - Token blacklisting for secure logout

ğŸ”¹ Security Implementation:
   - HS256 algorithm for token signing
   - Configurable secret key rotation
   - Token expiration validation
   - Automatic refresh token rotation
   - Blacklist integration for revoked tokens

ğŸ”¹ Custom Views:
   - LoginView: Custom authentication with rate limiting
   - LogoutView: Token blacklisting implementation
   - RefreshView: Secure token refresh with rotation
   - Protected endpoints with JWT verification

ğŸ”¹ Token Storage:
   - Access tokens: Client-side storage (short-lived)
   - Refresh tokens: Secure HTTP-only cookies (recommended)
   - Blacklisted tokens: Database storage for verification

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4. âš™ï¸ CUSTOM THROTTLING CLASSES
===============================

ğŸ“ Location: auth_service/utils/throttles.py

Advanced throttling system extending DRF's base throttling:

ğŸ”¹ EmailRateThrottle (Base Class):
   - Combines IP address and email for unique identification
   - Handles missing email gracefully
   - Configurable rate limits per subclass
   - Redis-backed for distributed systems

ğŸ”¹ Specialized Throttle Classes:
   
   ğŸšª LoginRateThrottle:
   - Rate: 5 attempts per minute
   - Scope: 'login'
   - Purpose: Prevent brute force attacks
   
   ğŸ”‘ PasswordResetRateThrottle:
   - Rate: 3 attempts per minute
   - Scope: 'password_reset'
   - Purpose: Prevent reset spam attacks
   
   ğŸ“ RegistrationRateThrottle:
   - Rate: 10 attempts per hour
   - Scope: 'registration'
   - Purpose: Prevent account creation spam
   
   âœ… PasswordResetCompletionRateThrottle:
   - Rate: 10 attempts per hour
   - Scope: 'password_reset_completion'
   - Purpose: Prevent reset completion abuse

ğŸ”¹ Cache Key Strategy:
   - Format: "throttle_{scope}_{ident}"
   - Unique identification per user/IP combination
   - Efficient Redis key management
   - Automatic expiration handling

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5. ğŸ›¡ï¸ SECURITY FEATURES OVERVIEW
================================

ğŸ”¹ Authentication Security:
   - JWT token-based authentication
   - Secure password hashing (Django's PBKDF2)
   - Password strength validation
   - Email uniqueness enforcement

ğŸ”¹ Rate Limiting Security:
   - Multi-layered rate limiting (IP + email)
   - Distributed rate limiting via Redis
   - Custom throttling classes per endpoint
   - Rate limit headers for client awareness

ğŸ”¹ Password Reset Security:
   - Cryptographically secure token generation
   - Time-limited token validity (10 minutes)
   - Single-use token consumption
   - Email verification before reset

ğŸ”¹ API Security:
   - CORS protection with whitelist domains
   - Request/response size limits
   - Input validation and sanitization
   - Error message sanitization

ğŸ”¹ Infrastructure Security:
   - Environment variable protection
   - Secure headers implementation
   - Database connection security
   - Redis connection authentication

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

6. ğŸ—„ï¸ DATABASE INTEGRATION
==========================

ğŸ”¹ Database Configuration:
   - PostgreSQL for production (Railway)
   - SQLite for development/testing
   - Environment-based database selection
   - Connection pooling and optimization

ğŸ”¹ User Model:
   - Extended AbstractUser model
   - Email as primary identification
   - Additional fields: full_name, date_joined
   - Proper indexing for performance

ğŸ”¹ Migrations:
   - Automatic migration generation
   - Version-controlled schema changes
   - Safe migration practices
   - Rollback capabilities

ğŸ”¹ Token Blacklist:
   - Database storage for blacklisted tokens
   - Efficient querying with indexes
   - Automatic cleanup of expired entries
   - Integration with JWT validation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

7. ğŸ“š API DOCUMENTATION SETUP
=============================

ğŸ”¹ Documentation Libraries:
   - drf-spectacular: Modern OpenAPI 3.0 schema generation
   - drf-yasg: Legacy Swagger 2.0 support
   - Custom schema extensions for authentication flows

ğŸ”¹ Schema Customization:
   ğŸ“ accounts/helpers/spectacular_schemas.py:
   - Custom authentication flow schemas
   - Rate limiting documentation
   - Error response examples
   - Request/response schema definitions

ğŸ”¹ Interactive Documentation:
   - Swagger UI: /swagger/ (interactive testing)
   - ReDoc: /redoc/ (clean documentation)
   - OpenAPI Schema: /api/schema/ (raw schema)

ğŸ”¹ Authentication Documentation:
   - JWT token usage examples
   - Rate limiting information
   - Error code explanations
   - Testing endpoints documentation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ DEVELOPMENT WORKFLOW
======================

1. ğŸ—ï¸ Setting Up Development Environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   pip install -r requirements.txt
   cp .env.example .env
   python manage.py migrate
   python manage.py runserver
   ```

2. ğŸ§ª Testing Rate Limiting:
   ```bash
   # Start server
   python manage.py runserver
   
   # Run rate limiting tests
   python auth_service/scripts/test_rate_limiting.py
   ```

3. ğŸ”„ Database Operations:
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   python manage.py createsuperuser
   ```

4. ğŸ“Š Running Tests:
   ```bash
   python manage.py test
   pytest --cov=accounts --cov=auth_service
   ```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ CONFIGURATION NOTES
======================

ğŸ”¹ Environment Variables:
   - DATABASE_URL: PostgreSQL connection string
   - REDIS_URL: Redis connection string
   - SECRET_KEY: Django secret key
   - DEBUG: Debug mode (True/False)
   - ALLOWED_HOSTS: Comma-separated host list

ğŸ”¹ Settings Structure:
   - base.py: Common settings
   - dev.py: Development overrides
   - prod.py: Production optimizations
   - railway.py: Railway-specific configuration

ğŸ”¹ Rate Limiting Configuration:
   - Throttle rates configurable per environment
   - Redis connection fallback handling
   - Custom cache key generation
   - Rate limit header inclusion

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ DEPLOYMENT CONSIDERATIONS
============================

ğŸ”¹ Railway Deployment:
   - Automatic PostgreSQL and Redis provisioning
   - Environment variable management
   - Automatic deployments on git push
   - Health check monitoring

ğŸ”¹ Docker Deployment:
   - Multi-stage Docker builds for optimization
   - Environment-based configuration
   - Volume management for static files
   - Container health checks

ğŸ”¹ Performance Optimization:
   - Redis connection pooling
   - Database query optimization
   - Static file serving optimization
   - Response caching strategies

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

End of Implementation Guide

For additional questions or clarifications, refer to:
- API Documentation: /swagger/ or /redoc/
- Source code comments in respective modules
- Test files for implementation examples
- Django and DRF official documentation
